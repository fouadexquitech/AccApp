<div class="container-fluid">
    <div class="p-3">
        <app-nav></app-nav>
    </div>
    <div class="p-3">
    <div class="row">
        <div class="col-sm-12 card">
            <div class="card-header">
                <h3 *ngIf="Revision">Revision {{Revision.prRevNo}} | {{Revision.prRevDate | date:'dd-MM-YYYY'}}</h3>
                <div class="row">
                    <div class="col-sm-4 form-group p-2">
                        <label>Item</label>
                        <input type="text" class="form-control" id="filterItemDesc">
                    </div>
                    <div class="col-sm-4 form-group p-2" [ngStyle]="{'display': (psByBoq == 0) ? 'block' : 'none'}">
                        <label>Resource</label>
                        <input type="text" class="form-control" id="filterResource">
                    </div>
                    <div class="col-sm-4 form-group p-2">
                        <br>
                        <button class="btn btn-primary" (click)="searchRevDetails()">Search</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <table *ngIf="RevisionDetailsList.length > 0 && psByBoq == 1" class="table" [id]="'tblRevisionDtl-' + Revision.prRevId">
                    <thead>
                      <tr>
                        
                        <th>Item Description</th>
                        <th>Price</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let dt of RevisionDetailsList; let k = index">
                          <td>{{dt.rdItemDescription}}</td>
                          <td>
                            <input type="hidden" [value]="dt.rdResourceSeq">  
                            <input type="hidden" [value]="dt.rdBoqItem">
                            <input *ngIf="dt.rdMissedPrice == 1" 
                            [value]="dt.rdPrice" type="number"
                            [className]="dt.rdMissedPrice == 1 ? 'form-control border-danger' : 'form-control'">
                            <span *ngIf="dt.rdMissedPrice != 1">{{dt.rdPrice}}</span></td>
                        </tr>
                    </tbody>
                    <tfoot>
                      <tr>
                        <td></td>
                        <td style="text-align: right;">
                          <button class="btn btn-success btn-block" [disabled]="saving"
                          (click)="UpdateRevisionPricesByBoq(Revision.prRevId, 'tblRevisionDtl-' + Revision.prRevId)">
                          <i class="fa fa-spinner fa-spin" *ngIf="saving"></i>
                          Update Prices</button>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                  <table *ngIf="RevisionDetailsList.length > 0 && psByBoq == 0" class="table" [id]="'tblRevisionDtl-' + Revision.prRevId">
                    <thead>
                      <tr>
                        <th>Item</th>
                        <th>Resources</th>
                    </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let it of RevisionDetailsBoqItems; let that = index">
                        <td width="50%">
                          {{it.descriptionO}}
                        </td>
                        <td>
                          <table class="table" *ngIf="checkIfItemExistsInResources(RevisionDetailsList, it.itemO) > 0">
                              
                              <tbody>
                                <tr *ngFor="let dt of getResourcesPerItem(RevisionDetailsList, it.itemO)">
                                  <td>
                                    {{dt.rdItemDescription}}
                                  </td>
                                  <td style="width:30%">
                                    <input type="hidden" [value]="dt.rdResourceSeq">
                                    <input *ngIf="dt.rdMissedPrice == 1" [id]="'price-' + dt.rdResourceSeq + '-' + + Revision.prRevId"
                                    [value]="dt.rdPrice" type="number"
                                    [className]="dt.rdMissedPrice == 1 ? 'form-control border-danger' : 'form-control'">
                                    <span *ngIf="dt.rdMissedPrice != 1">{{dt.rdPrice}}</span></td>
                                </tr>
                              </tbody>
                          </table>
                          
                        </td>

                      </tr>
                  </tbody>
                  <tfoot>
                    <tr>
                      <td></td>
                      <td style="text-align: right;">
                        <button class="btn btn-success btn-block" [disabled]="saving"
                        (click)="UpdateRevisionPrices(Revision.prRevId, 'tblRevisionDtl-' + Revision.prRevId)">
                        <i class="fa fa-spinner fa-spin" *ngIf="saving"></i>
                        Update Prices</button>
                      </td>
                    </tr>
                  </tfoot>
                  </table>
            </div>
        </div>
    </div>
    </div>
</div>